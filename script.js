// Image sources for each tab
const imageSources = {
    //pastpapers
    Q1: [
        'Q1/Screenshot_1.png',
        'Q1/Screenshot_2.png',
        'Q1/Screenshot_3.png',
        'Q1/Screenshot_4.png',
        'Q1/Screenshot_5.png',
        'Q1/Screenshot_6.png',
        'Q1/Screenshot_7.png',
        'Q1/Screenshot_8.png',
        'Q1/Screenshot_9.png',
        'Q1/Screenshot_10.png',
        'Q1/Screenshot_11.png',
        'Q1/Screenshot_12.png',
        'Q1/Screenshot_13.png',
        'Q1/Screenshot_14.png',
        'Q1/Screenshot_15.png',
        'Q1/Screenshot_16.png',
        'Q1/Screenshot_17.png',
        'Q1/Screenshot_18.png',
        'Q1/Screenshot_19.png',
        'Q1/Screenshot_20.png',
        'Q1/Screenshot_21.png',
        'Q1/Screenshot_22.png',
        'Q1/Screenshot_23.png',
        'Q1/Screenshot_24.png',
        'Q1/Screenshot_25.png',
        'Q1/Screenshot_26.png',
        'Q1/Screenshot_27.png',
        'Q1/Screenshot_28.png',
        'Q1/Screenshot_29.png',
        'Q1/Screenshot_30.png',
        'Q1/Screenshot_31.png',
        'Q1/Screenshot_32.png',
        'Q1/Screenshot_33.png',
        'Q1/Screenshot_34.png',
        'Q1/Screenshot_35.png',
        'Q1/Screenshot_36.png',
        'Q1/Screenshot_37.png',
        'Q1/Screenshot_38.png',
        'Q1/Screenshot_39.png',
        'Q1/Screenshot_40.png',
        'Q1/Screenshot_41.png',
        'Q1/Screenshot_42.png',
        'Q1/Screenshot_43.png',
        'Q1/Screenshot_44.png',
        'Q1/Screenshot_45.png',
        'Q1/Screenshot_46.png'

    ],
    //tafouk
    Q2: [
        'Q2/Screenshot_1.png',
        'Q2/Screenshot_2.png',
        'Q2/Screenshot_3.png',
        'Q2/Screenshot_4.png',
        'Q2/Screenshot_5.png',
        'Q2/Screenshot_6.png',
        'Q2/Screenshot_7.png',
        'Q2/Screenshot_8.png',
        'Q2/Screenshot_9.png',
        'Q2/Screenshot_10.png',
        'Q2/Screenshot_11.png',
        'Q2/Screenshot_12.png',
        'Q2/Screenshot_13.png',
        'Q2/Screenshot_14.png',
        'Q2/Screenshot_15.png',
        'Q2/Screenshot_16.png',
        'Q2/Screenshot_17.png',
        'Q2/Screenshot_18.png',
        'Q2/Screenshot_19.png',
        'Q2/Screenshot_20.png',
        'Q2/Screenshot_21.png',
        'Q2/Screenshot_22.png',
        'Q2/Screenshot_23.png',
        'Q2/Screenshot_24.png',
        'Q2/Screenshot_25.png',
        'Q2/Screenshot_26.png',
        'Q2/Screenshot_27.png',
        'Q2/Screenshot_28.png',
        'Q2/Screenshot_29.png',
        'Q2/Screenshot_30.png',
        'Q2/Screenshot_31.png',
        'Q2/Screenshot_32.png',
        'Q2/Screenshot_33.png',
        'Q2/Screenshot_34.png',
        'Q2/Screenshot_35.png',
        'Q2/Screenshot_36.png',
        'Q2/Screenshot_37.png',
        'Q2/Screenshot_38.png',
        'Q2/Screenshot_39.png',
        'Q2/Screenshot_40.png',
        'Q2/Screenshot_41.png',
        'Q2/Screenshot_42.png',
        'Q2/Screenshot_43.png',
        'Q2/Screenshot_44.png',
        'Q2/Screenshot_45.png',
        'Q2/Screenshot_46.png',
        'Q2/Screenshot_47.png',
        'Q2/Screenshot_48.png',
        'Q2/Screenshot_49.png',
        'Q2/Screenshot_50.png',
        'Q2/Screenshot_51.png',
        'Q2/Screenshot_52.png',
        'Q2/Screenshot_53.png',
        'Q2/Screenshot_54.png',
        'Q2/Screenshot_55.png',
        'Q2/Screenshot_56.png',
        'Q2/Screenshot_57.png',
        'Q2/Screenshot_58.png',
        'Q2/Screenshot_59.png'
    ],
    //moasser
    Q3: [
        'Q3/Screenshot_1.png',
        'Q3/Screenshot_2.png',
        'Q3/Screenshot_3.png',
        'Q3/Screenshot_4.png',
        'Q3/Screenshot_5.png',
        'Q3/Screenshot_6.png',
        'Q3/Screenshot_7.png',
        'Q3/Screenshot_8.png',
        'Q3/Screenshot_9.png',
        'Q3/Screenshot_10.png',
        'Q3/Screenshot_11.png',
        'Q3/Screenshot_12.png',
        'Q3/Screenshot_13.png',
        'Q3/Screenshot_14.png',
        'Q3/Screenshot_15.png',
        'Q3/Screenshot_16.png',
        'Q3/Screenshot_17.png',
        'Q3/Screenshot_18.png',
        'Q3/Screenshot_19.png',
        'Q3/Screenshot_20.png',
        'Q3/Screenshot_21.png',
        'Q3/Screenshot_22.png',
        'Q3/Screenshot_23.png',
        'Q3/Screenshot_24.png',
        'Q3/Screenshot_25.png',
        'Q3/Screenshot_26.png',
        'Q3/Screenshot_27.png',
        'Q3/Screenshot_28.png',
        'Q3/Screenshot_29.png',
        'Q3/Screenshot_30.png',
        'Q3/Screenshot_31.png',
        'Q3/Screenshot_32.png',
        'Q3/Screenshot_33.png',
        'Q3/Screenshot_34.png',
        'Q3/Screenshot_35.png',
        'Q3/Screenshot_36.png',
        'Q3/Screenshot_37.png',
        'Q3/Screenshot_38.png',
        'Q3/Screenshot_39.png',
        'Q3/Screenshot_40.png',
        'Q3/Screenshot_41.png',
        'Q3/Screenshot_42.png',
        'Q3/Screenshot_43.png',
        'Q3/Screenshot_44.png',
        'Q3/Screenshot_45.png',
        'Q3/Screenshot_46.png',
        'Q3/Screenshot_47.png',
        'Q3/Screenshot_48.png',
        'Q3/Screenshot_49.png',
        'Q3/Screenshot_50.png',
        'Q3/Screenshot_51.png',
        'Q3/Screenshot_52.png',
        'Q3/Screenshot_53.png',
        'Q3/Screenshot_54.png',
        'Q3/Screenshot_55.png',
        'Q3/Screenshot_56.png',
        'Q3/Screenshot_57.png',
        'Q3/Screenshot_58.png',
        'Q3/Screenshot_59.png',
        'Q3/Screenshot_60.png',
        'Q3/Screenshot_61.png',
        'Q3/Screenshot_62.png',
        'Q3/Screenshot_63.png',
        'Q3/Screenshot_64.png',
        'Q3/Screenshot_65.png',
        'Q3/Screenshot_66.png',
        'Q3/Screenshot_67.png',
        'Q3/Screenshot_68.png',
        'Q3/Screenshot_69.png',
        'Q3/Screenshot_70.png',
        'Q3/Screenshot_71.png',
        'Q3/Screenshot_72.png',
        'Q3/Screenshot_73.png',
        'Q3/Screenshot_74.png',
        'Q3/Screenshot_75.png'

    ],
};

let currentTab = 'Q1';
let score = 0;
let currentImageIndex = -1;
let timeLeft = 240; // 4 minutes in seconds
let timerInterval;

// DOM elements
const scoreElement = document.getElementById('scoreValue');
const solvedButton = document.getElementById('solvedBtn');
const skipButton = document.getElementById('skipBtn');
const problemImage = document.getElementById('problemImage');
const timerElement = document.getElementById('timer');
const tabButtons = document.querySelectorAll('.tab-btn');
const tabSelect = document.getElementById('tabSelect');

// Function to format time as MM:SS
function formatTime(seconds) {
    const minutes = Math.floor(seconds / 60);
    const remainingSeconds = seconds % 60;
    return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
}

// Function to get random image from current tab
function getRandomImage() {
    const images = imageSources[currentTab];
    let newIndex;
    do {
        newIndex = Math.floor(Math.random() * images.length);
    } while (newIndex === currentImageIndex && images.length > 1);
    
    currentImageIndex = newIndex;
    problemImage.src = images[currentImageIndex];
}

// Function to update score with animation
function updateScore(newScore) {
    scoreElement.textContent = newScore;
    scoreElement.classList.remove('animate');
    void scoreElement.offsetWidth; // Trigger reflow
    scoreElement.classList.add('animate');
}

// Function to show the LOSER screen
function showLoserScreen() {
    const loserDiv = document.createElement('div');
    loserDiv.className = 'loser';
    loserDiv.textContent = 'LOSER';
    document.body.appendChild(loserDiv);
    
    setTimeout(() => {
        loserDiv.remove();
        resetGame();
    }, 3000);
}

// Function to reset timer
function resetTimer() {
    timeLeft = 240;
    updateTimer();
    // Clear existing interval and start a new one
    clearInterval(timerInterval);
    timerInterval = setInterval(() => {
        timeLeft--;
        updateTimer();
    }, 1000);
}

// Function to reset game
function resetGame() {
    score = 0;
    updateScore(score);
    resetTimer();
    getRandomImage();
}

// Function to update timer
function updateTimer() {
    timerElement.textContent = formatTime(timeLeft);
    
    // Add warning animation every 10 seconds
    if (timeLeft % 10 === 0 && timeLeft > 0) {
        timerElement.classList.add('warning');
        setTimeout(() => {
            timerElement.classList.remove('warning');
        }, 1000);
    }

    if (timeLeft <= 0) {
        showLoserScreen();
    }
}

// Handle solved button click
solvedButton.addEventListener('click', () => {
    score++;
    updateScore(score);
    document.body.classList.add('flash-green');
    resetTimer();
    
    setTimeout(() => {
        document.body.classList.remove('flash-green');
        getRandomImage();
    }, 800);
});

// Handle skip button click
skipButton.addEventListener('click', () => {
    if (score > 0) {
        score--;
        updateScore(score);
    }
    resetTimer();
    getRandomImage();
});

// Handle tab switching
function switchTab(tab) {
    currentTab = tab;
    tabButtons.forEach(btn => {
        if (btn.dataset.tab === tab) {
            btn.classList.add('active');
            resetTimer();
        } else {
            btn.classList.remove('active');
        }
    });
    getRandomImage();
}

tabButtons.forEach(btn => {
    btn.addEventListener('click', () => switchTab(btn.dataset.tab));
});

// Handle mobile tab select
tabSelect.addEventListener('change', (e) => switchTab(e.target.value));

// Start timer - will run continuously
timerInterval = setInterval(() => {
    timeLeft--;
    updateTimer();
}, 1000);

// Initialize game
getRandomImage();
resetTimer();